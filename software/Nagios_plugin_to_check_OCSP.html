
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Nagios Plugin To Check An Ocsp Server With Hardcoded Certificate - Raymii.org</title>
        <link href="/s/inc/css/bootstrap.css" rel="stylesheet" />
        <link href="/s/inc/js/google-code-prettify/prettify.css" rel="stylesheet" />
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    </head>
    <body>
        <a id="top-of-page"></a>
        <div class="container-fluid ">
        <div class="row-fluid">
        
        <div class="span10 offset1">
                
            <div class="span4 well"> 
            
                <h1 class="topheader">Raymii.org</h1>
                <h6>Quis custodiet ipsos custodes?</h6>
                <h6><a href="/s/feed.xml">RSS</a></h6>
            
            </div>

            <div class="span4 green-block">
                
                    <h3>Featured Items</h3>
    <a href="/s/tutorials/Ansible.html" class="whitelink">Ansible</a>
<br />
<a href="/s/tutorials/Autossh_persistent_tunnels.html" class="whitelink">Autossh persistent tunnels</a>
<br />
<a href="/s/software/Codename_Geld.html" class="whitelink">Codename Geld</a>
<br />
<a href="/s/tutorials/Munin_optimalization_on_Debian.html" class="whitelink">Munin optimalization on Debian</a>
<br />
<a href="/s/articles/Small_Linux_PCs.html" class="whitelink">Small Linux PCs</a>
<br />

            
        </div>
        <div class="span4 green-block">
            
                <h3>Featured Items</h3>
    <a href="/s/software/Bash_PHP_Server_Status_Monitor.html" class="whitelink">Bash PHP Server Status Monitor</a>
<br />
<a href="/s/articles/Encryption-on-ANY-cloud-service.html" class="whitelink">Encryption on ANY cloud service</a>
<br />
<a href="/s/tutorials/IPSEC_L2TP_vpn_with_Ubuntu_12.04.html" class="whitelink">IPSEC L2TP vpn with Ubuntu 12.04</a>
<br />
<a href="/s/software/NutsManager.html" class="whitelink">NutsManager</a>
<br />
<a href="/s/tutorials/Tahoe_LAFS_Storage_Grid.html" class="whitelink">Tahoe LAFS Storage Grid</a>
<br />

            
        </div>
    </div>
    
    </div>
    <div class="row-fluid">
    <div class="span10 offset1">
    

    <div class="span3">
    <h3>Menu</h3><ul class="nav nav-pills nav-stacked">
<li><a href="/s/" class="link">Home</a>
</li>
<li><a href="/s/static/Disclaimer.html" class="link">Disclaimer</a>
</li>
<li><a href="/s/static/Terrible-Linux.html" class="link">Terrible Linux</a>
</li>
</ul>
<h3>Categories</h3>
<ul class="nav nav-pills nav-stacked">
<li><a href="/s/articles" class="link">Articles</a>
</li>
<li><a href="/s/snippets" class="link">Snippets</a>
</li>
<li><a href="/s/software" class="link">Software</a>
</li>
<li><a href="/s/tutorials" class="link">Tutorials</a>
</li>
</ul></div>  <div class="span7">   <div class="inner"><h2>Nagios plugin to check an OCSP server with hardcoded certificate</h2>
<ul class="breadcrumb">
<li><a href="../" class="link">Home</a>
<span class="divider">/</span></li>
<li><a href="../software" class="link">Software</a>
<span class="divider">/</span></li>
<li><a href="Nagios_plugin_to_check_OCSP.html" class="link">Nagios plugin to check an OCSP server with hardcoded certificate</a>
</li>
</ul>
<h6>Author: Remy Van Elst</h6>
<h6>Date: 01-11-2012</h6>
<br></br>
<p>This is a nagios plugin to check an OCSP server. It does so by having a PEM encoded certificate in the code, and the PEM encoded certificate of the issuer. This is sent to the OCSP server and the response is then parsed to give the correct nagios result. It is targeted at administrators who have their own OCSP and need to know when it is not working. </p>

<p>The certificate is in the code because this saves going to a website and getting the certificate, the issuers certificate and then sending that to the OCSP server. It also can be used for certificates which are not public.</p>

<p><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Do you need a VPS for hosting nagios? InceptionHosting has very good VPS servers!</a></p>

<h4>Download</h4>

<p><a href="https://raw.github.com/RaymiiOrg/nagios/">Download the plugin from my github</a> <br />
<a href="https://raymii.org/cms/content/downloads/check_ocsp_hard.sh">Download the plugin from raymii.org</a> <br />
<a href="https://raymii.org/cms/content/downloads/check_ocsp_hard.sh.txt">View the source code in the browser</a>  </p>

<h4>Installation and usage</h4>

<p>This guide covers the steps needed for Ubuntu 10.04/12.04 and Debian 6. It should also work on other distro's, but make sure to modify the commands where needed (package installation for example).</p>

<p>First make sure you have the required tools:</p>

<pre><code>apt-get install gawk grep bash sed wget curl openssl
</code></pre>

<p>Place the script on the nagios host (I've placed it in <em>/etc/nagios/plugins/</em>):</p>

<pre><code>wget -O */etc/nagios/plugins/check_ocsp_hard.sh http://raymii.org/cms/downloads/check_ocsp_hard.sh
</code></pre>

<p>Make sure that the script is executable:</p>

<pre><code>chmod +x /etc/nagios/plugins/check_ocsp_hard.sh
</code></pre>

<p>Now test it:</p>

<pre><code>/etc/nagios/plugins/check_ocsp_hard.sh
OK: OCSP up and running - status of certificate for raymii.org GOOD by OCSP: http://ocsp.comodoca.com/
</code></pre>

<p>You have to put your own PEM encoded certificate in the script. You also need to place the PEM encoded certificate of the issuer of your certificate in the script. The variable <code>CERTTOCHECK</code> contains your certificate, the variable <code>ISSUERCERT</code> contains the issuer certificate.</p>

<p>A way of getting those certificate is via the following <em>openssl</em> command:</p>

<pre><code>echo -n |openssl s_client -connect $DOMAIN:$PORT -showcerts
</code></pre>

<p>where you of course replace $DOMAIN and $PORT with the domain and the port you want to query. If your certificate is directly signed by one of the browsers trusted certificates (you don't send a chain) you have to get that (issuer) certificate another way. </p>

<p>When you've replaced my certificate with your own we are ready to configure it in Nagios.</p>

<p>Lets create a command definition:</p>

<pre><code>define command{
    command_name    ocsp_check_hard
    command_line    /etc/nagios-plugins/check_ocsp_hard.sh
}
</code></pre>

<p>And a service check:</p>

<pre><code>define service {
        use                             generic-service
        host_name                       localhost
        service_description             OCSP check of $OCSP with hardcoded certificate of $DOMAIN
        contact                         nagiosadmin                 
        check_command                   ocsp_check_hard
}
</code></pre>

<p>This defines a service check on the host <em>localhost</em>, and with contact <em>nagiosadmin</em>. Be sure to replace $OCSP with the name/url of the OCSP you hardcoded, and $DOMAIN with the name of the domain/name of certificate that is used. </p>

<p>If you need to monitor multiple OCSP's (you maybe have more than one CA instance running) you need to have multiple copies of this script with different hardcoded certificates. You also need multiple commands and service checks.</p>
<hr></hr>
Tags: <a href="../tags/certificates.html" class="link">certificates, 
</a>
<a href="../tags/dogtag.html" class="link">dogtag, 
</a>
<a href="../tags/monitoring.html" class="link">monitoring, 
</a>
<a href="../tags/nagios.html" class="link">nagios, 
</a>
<a href="../tags/ocsp.html" class="link">ocsp, 
</a>
<a href="../tags/openssl.html" class="link">openssl, 
</a>
<a href="../tags/ssl.html" class="link">ssl, 
</a>
<div class="footer">
                <hr>

                <p>Generated by <a href="https://raymii.org/s/software/ingsoc.html">ingsoc</a>.<br />

                <small>af6e572fec2abb8509e6c4562a57f0</small></p>

                <small><a href="http://validator.w3.org/check/referer" target="_blank">Validate XHTML</a></small>

                </div>
            </div>
        </div>
    </div>  
    </div>
    </div>    
    </body>
    </html>
    